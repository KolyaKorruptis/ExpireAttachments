<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">

<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
	<id>Suki:ExpireAttachments</id>
	<version>1.0</version>

	<file name="$sourcedir/Display.php">
		<operation>
			<search position="replace"><![CDATA[a.id_attach, a.id_folder, a.id_msg, a.filename, a.file_hash, IFNULL(a.size, 0) AS filesize, a.downloads, a.approved,]]></search>
			<add><![CDATA[a.id_attach, a.id_folder, a.id_msg, a.filename, a.file_hash, IFNULL(a.size, 0) AS filesize, a.downloads, a.approved, a.expire_date,]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA['is_approved' => $attachment['approved'],]]></search>
			<add><![CDATA['is_approved' => $attachment['approved'],
				'expire_date' => $attachment['expire_date'],]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[]]></search>
			<add><![CDATA[]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[]]></search>
			<add><![CDATA[]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[]]></search>
			<add><![CDATA[]]></add>
		</operation>
	</file>

	<file name="$sourcedir/Post.php">
		<operation>
			<search position="replace"><![CDATA[$context['can_post_attachment_unapproved'] = allowedTo('post_attachment');]]></search>
			<add><![CDATA[$context['can_post_attachment_unapproved'] = allowedTo('post_attachment');

	// Expire Attachments mod
	if (!empty($modSettings['ExAt_setting_enable']) && (allowedTo('ExAt_day') || allowedTo('ExAt_week') || allowedTo('ExAt_month') || allowedTo('ExAt_year')))
	{
		$context['ExAt_list'] = '<select name="expire_date">';

		// Set the hardcoded periods
		$ExAt_periods = array('Day', 'Week', 'Month', 'Year');

		// Add each option if the user has the permission to use it
		foreach  ($ExAt_periods as $period)
			if (allowedTo('ExAt_'. $period))
				$context['ExAt_list'] .= '<option value="'. $period .'">'. $period .'</option>';
	}

	else
		$context['eam_list'] = false;
	// Expire Attachments mod end]]></add>
		</operation>
	</file>

	<file name="$themedir/Profile.template.php">
		<operation>
			<search position="replace"><![CDATA[]]></search>
			<add><![CDATA[]]></add>
		</operation>
	</file>

	<file name="$themedir/Display.template.php">
		<operation>
			<search position="replace"><![CDATA[]]></search>
			<add><![CDATA[]]></add>
		</operation>
	</file>

</modification>